# Clineルール設定ガイド

このドキュメントは、Clineのルール設定について新人エンジニアが理解できるように基本から応用までをまとめたものです。

## 目次

1. [Clineルール設定の基本](#1-clineルール設定の基本)
2. [ルールファイルの形式](#2-ルールファイルの形式)
3. [ルールファイルの配置と読み込み順序](#3-ルールファイルの配置と読み込み順序)
4. [ルールファイルの構成要素](#4-ルールファイルの構成要素)
5. [プロジェクト固有の設定](#5-プロジェクト固有の設定)
6. [パフォーマンス最適化](#6-パフォーマンス最適化)
7. [具体的な使用例](#7-具体的な使用例)

## 1. Clineルール設定の基本

Clineは、AIアシスタントの振る舞いや機能を定義するためのルール設定システムを提供しています。ルール設定により、以下のことが可能になります：

- アシスタントの名前や説明の定義
- アシスタントの振る舞いを制御する指示の設定
- 利用可能な機能やツールの制限
- 応答言語の指定
- プロジェクト固有の設定

ルール設定は、ファイルベースで行われ、プロジェクトごとに異なる設定を適用することができます。

## 2. ルールファイルの形式

Clineのルール設定には、主に2つの形式があります：

### 2.1 JSON形式 (.cline.json)

JSON形式は、構造化されたデータを表現するための標準的な形式です。

**例：**

```json
{
  "name": "カスタムアシスタント",
  "description": "あなたのカスタムアシスタントの説明をここに書きます",
  "instructions": [
    "あなたは親切で役立つアシスタントです。",
    "ユーザーの質問に対して明確で簡潔な回答を提供してください。",
    "専門的な知識を活用して、正確な情報を提供してください。"
  ],
  "capabilities": {
    "code": true,
    "vision": true,
    "file_search": true,
    "file_edit": true,
    "terminal": true,
    "browser": true
  },
  "tools": [
    "execute_command",
    "read_file",
    "write_to_file",
    "replace_in_file",
    "search_files",
    "list_files",
    "list_code_definition_names",
    "browser_action",
    "ask_followup_question",
    "attempt_completion"
  ],
  "language": "ja"
}
```

**特徴：**
- 機械的に解析しやすい
- 構造が厳格
- エラーが発生しやすい（括弧やカンマの欠落など）
- コメントの追加が難しい

### 2.2 MDC形式 (.mdc)

MDC（Markdown Configuration）形式は、Markdown構文を使用した人間が読みやすい設定形式です。

**例：**

```markdown
# アシスタントの基本設定

## 名前
カスタムアシスタント

## 説明
あなたのカスタムアシスタントの説明をここに書きます

## 指示
- あなたは親切で役立つアシスタントです。
- ユーザーの質問に対して明確で簡潔な回答を提供してください。
- 専門的な知識を活用して、正確な情報を提供してください。

## 機能
- code: true
- vision: true
- file_search: true
- file_edit: true
- terminal: true
- browser: true

## ツール
- execute_command
- read_file
- write_to_file
- replace_in_file
- search_files
- list_files
- list_code_definition_names
- browser_action
- ask_followup_question
- attempt_completion

## 言語
ja
```

**特徴：**
- 人間が読みやすく編集しやすい
- 構造が柔軟
- エラーが発生しにくい
- コメントや説明の追加が容易
- 複数ファイルでの管理が容易

## 3. ルールファイルの配置と読み込み順序

### 3.1 ファイルの配置場所

ルールファイルは、以下の場所に配置することができます：

1. **ルートディレクトリ**：
   - `.cline.json`：プロジェクトのルートディレクトリに配置

2. **ルールディレクトリ**：
   - `.cline/rules/*.mdc`：`.cline/rules`ディレクトリ内にMDC形式のファイルを配置

3. **ユーザーのホームディレクトリ**：
   - `~/.cline/rules/*.mdc`：ユーザーのホームディレクトリの`.cline/rules`内にファイルを配置

### 3.2 読み込み順序

ルールファイルの読み込み順序は以下の通りです：

1. **グローバル設定**（ユーザーのホームディレクトリ）
   - `~/.cline/rules/*.mdc`

2. **ローカル設定**（プロジェクトディレクトリ）
   - `.cline/rules/*.mdc`
   - `.cline.json`

後から読み込まれるファイルの設定が優先されます。つまり、プロジェクトディレクトリの設定は、ユーザーのホームディレクトリの設定よりも優先されます。

### 3.3 MDCファイルの読み込み順序

`.cline/rules`ディレクトリ内の複数のMDCファイルは、以下の順序で読み込まれます：

1. アルファベット順
2. 数字プレフィックスがある場合は、その順序（例：`01-base.mdc`、`02-specific.mdc`）

## 4. ルールファイルの構成要素

ルールファイルには、以下の主要な構成要素があります：

### 4.1 基本情報

- **name**：アシスタントの名前
- **description**：アシスタントの説明

### 4.2 指示（instructions）

アシスタントの振る舞いを定義する指示のリストです。例えば：

- 「あなたは親切で役立つアシスタントです。」
- 「ユーザーの質問に対して明確で簡潔な回答を提供してください。」
- 「専門的な知識を活用して、正確な情報を提供してください。」

### 4.3 機能（capabilities）

アシスタントが使用できる機能を定義します：

- **code**：コード関連のタスク実行能力
- **vision**：画像認識・理解能力
- **file_search**：ファイル検索機能
- **file_edit**：ファイル編集機能
- **terminal**：コマンド実行機能
- **browser**：ブラウザ操作機能

### 4.4 ツール（tools）

アシスタントが使用できる特定のツールを定義します：

- execute_command
- read_file
- write_to_file
- replace_in_file
- search_files
- list_files
- list_code_definition_names
- browser_action
- ask_followup_question
- attempt_completion

### 4.5 言語（language）

アシスタントの応答言語を指定します（例：`ja`は日本語）。

## 5. プロジェクト固有の設定

### 5.1 設定ファイルの優先順位

複数の設定ファイルが存在する場合、以下の優先順位で適用されます：

1. プロジェクトディレクトリの`.cline.json`
2. プロジェクトディレクトリの`.cline/rules/*.mdc`
3. ユーザーのホームディレクトリの`.cline/rules/*.mdc`

### 5.2 設定の選択的読み込み

`.cline/config.json`ファイルを使用して、読み込むルールファイルを制御できます：

```json
{
  "rules": {
    "include": ["react"],
    "exclude": ["python"]
  }
}
```

- **include**：明示的に読み込むルールファイルのリスト
- **exclude**：明示的に除外するルールファイルのリスト

これにより、プロジェクトに関連するルールファイルのみを読み込むことができます。

## 6. パフォーマンス最適化

### 6.1 ルールファイルの分割

大きな汎用ルールファイルではなく、小さな特化型ルールファイルを作成することをお勧めします：

- `general.mdc`：一般的な設定
- `react.mdc`：React開発用の設定
- `python.mdc`：Python開発用の設定

### 6.2 選択的読み込みの活用

`.cline/config.json`ファイルを使用して、プロジェクトに必要なルールファイルのみを読み込むようにします：

```json
{
  "rules": {
    "include": ["react"],
    "exclude": ["python"]
  }
}
```

これにより、不要なルールファイルを読み込まないため、起動時間が短縮され、トークンの使用量が削減されます。

### 6.3 階層的な設定構造

- ユーザーのホームディレクトリに基本ルールを配置
- プロジェクトディレクトリに特化型ルールを配置
- `.cline/config.json`で読み込みを制御

## 7. 具体的な使用例

### 7.1 基本的な設定（単一プロジェクト）

プロジェクトのルートディレクトリに`.cline.json`ファイルを作成します：

```json
{
  "name": "カスタムアシスタント",
  "description": "あなたのカスタムアシスタントの説明をここに書きます",
  "instructions": [
    "あなたは親切で役立つアシスタントです。",
    "ユーザーの質問に対して明確で簡潔な回答を提供してください。",
    "専門的な知識を活用して、正確な情報を提供してください。"
  ],
  "language": "ja"
}
```

### 7.2 複数のルールファイル（複数プロジェクト）

#### ユーザーのホームディレクトリ

`~/.cline/rules/default.mdc`：

```markdown
# デフォルト設定

## 名前
基本アシスタント

## 説明
基本的なアシスタント設定

## 指示
- あなたは親切で役立つアシスタントです。
- ユーザーの質問に対して明確で簡潔な回答を提供してください。

## 言語
ja
```

#### Reactプロジェクト

`.cline/rules/react.mdc`：

```markdown
# Reactアシスタントの設定

## 名前
Reactアシスタント

## 説明
Reactアプリケーション開発を支援するアシスタント

## 指示
- あなたはReact開発の専門家です。
- コンポーネント設計のベストプラクティスを提案してください。
- パフォーマンス最適化の観点からコードをレビューしてください。

## 言語
ja
```

`.cline/config.json`：

```json
{
  "rules": {
    "include": ["react"],
    "exclude": ["python"]
  }
}
```

#### Pythonプロジェクト

`.cline/rules/python.mdc`：

```markdown
# Pythonアシスタントの設定

## 名前
Pythonアシスタント

## 説明
Python開発を支援するアシスタント

## 指示
- あなたはPython開発の専門家です。
- PEP 8スタイルガイドに従ったコードを提案してください。
- 効率的なデータ構造とアルゴリズムを推奨してください。

## 言語
ja
```

`.cline/config.json`：

```json
{
  "rules": {
    "include": ["python"],
    "exclude": ["react"]
  }
}
```

### 7.3 推奨されるディレクトリ構造

```
ユーザーのホームディレクトリ/
  .cline/
    rules/
      default.mdc      # 基本設定

プロジェクトA（React）/
  .cline/
    config.json        # Reactルールを含め、Pythonルールを除外
    rules/
      react.mdc        # React専用のルール

プロジェクトB（Python）/
  .cline/
    config.json        # Pythonルールを含め、Reactルールを除外
    rules/
      python.mdc       # Python専用のルール
```

## まとめ

Clineのルール設定は、AIアシスタントの振る舞いや機能を柔軟にカスタマイズするための強力な仕組みを提供しています。JSON形式とMDC形式の両方をサポートし、グローバル設定とプロジェクト固有の設定を組み合わせることができます。

パフォーマンスを最適化するために、プロジェクトに必要なルールファイルのみを読み込むように設定することをお勧めします。これにより、起動時間の短縮やトークンの使用量の削減が可能になります。

適切なルール設定により、プロジェクトごとに最適化されたAIアシスタントを活用することができます。
